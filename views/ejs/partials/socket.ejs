<script>
    let student = null
    let socket = null
    let user_data_form = document.getElementById('user_data')
    let chat_container = document.getElementById('chat_container')
    let chat_box = document.getElementById('text-container')
    let send_button = document.getElementById('send-socket')
    let text_input = document.getElementById('input-text')
    user_data_form.addEventListener('submit', e=>{
        e.preventDefault()
        student = {
            name: e.target[0].value,
            email: e.target[1].value
        }
        if(student.name == '' || student.email == ''){
            window.location.reload()
        }
        socket = io()
        socket.emit('addUser', student);
        chat_container.classList.add('active')
        readSockets()
    })
    send_button.addEventListener('click', e=>{
        let sentMessage = {
            ...student,
            message: text_input.value
        }
        socket.emit('message', sentMessage)
        text_input.value = ''
    })
    function loadChat(){

        socket.on('init', data=>{
            let inner = ``
            data.forEach(element=>{
                inner += `<b>${element.name}: <i>${element.message}</i></b><br>`
            })
            chat_box.innerHTML = inner
        })
    }
    function readSockets(){
        loadChat()
        socket.on('emitToAll', data=>{
            console.log('mensaje recibido')
            let inner = ``
            data.forEach(element=>{
                inner += `<b>${element.name}: <i>${element.message}</i></b><br>`
            })
            chat_box.innerHTML = inner
        })
    }
</script>