<script>
    let user = null
    let user_data_form = document.getElementById('user_data')
    let chat_container = document.getElementById('chat_container')
    let chat_box = document.getElementById('text-container')
    let send_button = document.getElementById('send-socket')
    let text_input = document.getElementById('input-text')
    loadChat()
    user_data_form.addEventListener('submit', e=>{
        e.preventDefault()
        user = {
            id: e.target[4].value,
            nombre: e.target[0].value,
            apellido: e.target[1].value,
            alias: e.target[2].value,
            edad: e.target[3].value
        }
        if(user.name == '' || user.email == ''){
            window.location.reload()
        }
        socket.emit('addUser', user);
        chat_container.classList.add('active')
        readSockets()
    })
    send_button.addEventListener('click', e=>{
        let sentMessage = {
            author: {...user},
            mensaje: text_input.value
        }
        socket.emit('message', sentMessage)
        text_input.value = ''
    })
    function loadChat(){
        socket.on('init', data=>{
            console.log(data)
            let inner = ``
            data.forEach(element=>{
                inner += `<b>${element.author.alias}: <i>${element.mensaje}</i></b><br>`
            })
            chat_box.innerHTML = inner
        })
    }
    function readSockets(){
        socket.on('emitToAll', data=>{
            console.log('mensaje recibido')
            let inner = ``
            data.forEach(element=>{
                inner += `<b>${element.author.alias}: <i>${element.mensaje}</i></b><br>`
            })
            chat_box.innerHTML = inner
        })
    }
</script>